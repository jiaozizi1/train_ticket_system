<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>我的车票 - 车站售票系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .ticket-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }
        .ticket-header {
            background: linear-gradient(135deg, #007bff 0%, #00c6ff 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .ticket-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .ticket-body {
            padding: 20px;
        }
        .ticket-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        .ticket-item {
            flex: 1;
            min-width: 120px;
        }
        .ticket-label {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 5px;
        }
        .ticket-value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        .ticket-divider {
            border-top: 1px dashed #dee2e6;
            margin: 15px 0;
        }
        .no-tickets {
            padding: 80px 0;
            text-align: center;
            color: #6c757d;
        }
        .btn-refund {
            transition: all 0.3s;
        }
        .btn-refund:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(220, 53, 69, 0.2);
        }
        .ticket-corner {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #f8f9fa;
            border-radius: 0 0 0 12px;
            right: 0;
            top: 0;
        }
        .ticket-corner::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 0 0 0 10px;
            right: 0;
            top: 0;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="/">
            <i class="bi bi-train fs-4 me-2"></i>
            <span>车站售票系统</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav me-auto">
                <a class="nav-link" href="/">首页</a>
                <a class="nav-link" href="/trains">车次查询</a>
                <a class="nav-link" href="/home">个人中心</a>
                <a class="nav-link active" href="/tickets/my-tickets">我的车票</a>
            </div>
            <div class="navbar-nav">
                <a class="nav-link" href="/logout">
                    <i class="bi bi-box-arrow-right me-1"></i>退出登录
                </a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold">
            <i class="bi bi-ticket-detailed me-2"></i>我的车票
        </h4>
        <a href="/trains" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>购买新票
        </a>
    </div>

    <div th:if="${param.success}" class="alert alert-success alert-dismissible fade show mb-3">
        <i class="bi bi-check-circle me-2"></i>购票成功！您的车票已生成
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${param.refunded}" class="alert alert-success alert-dismissible fade show mb-3">
        <i class="bi bi-check-circle me-2"></i>退票成功！款项将原路返回
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <div th:if="${param.error}" class="alert alert-danger alert-dismissible fade show mb-3">
        <i class="bi bi-exclamation-triangle me-2"></i>[[${param.error}]]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${tickets != null and not tickets.isEmpty()}">
        <div th:each="ticket : ${tickets}" class="ticket-card">
            <div class="ticket-corner"></div>
            <div class="ticket-header">
                <h5 class="mb-0">车票编号: [[${ticket.ticketNumber}]]</h5>
                <span th:if="${ticket.status == 'ACTIVE'}" class="ticket-status bg-success">
                        <i class="bi bi-check-circle me-1"></i>有效
                    </span>
                <span th:unless="${ticket.status == 'ACTIVE'}" class="ticket-status bg-secondary">
                        <i class="bi bi-x-circle me-1"></i>已退票
                    </span>
            </div>
            <div class="ticket-body">
                <div class="ticket-info">
                    <div class="ticket-item">
                        <div class="ticket-label">车次</div>
                        <div class="ticket-value">[[${ticket.train.trainNumber}]]</div>
                    </div>
                    <div class="ticket-item">
                        <div class="ticket-label">座位号</div>
                        <div class="ticket-value">[[${ticket.seatNumber}]]</div>
                    </div>
                    <div class="ticket-item">
                        <div class="ticket-label">购票时间</div>
                        <div class="ticket-value">[[${ticket.purchaseTime}]]</div>
                    </div>
                </div>

                <div class="ticket-divider"></div>

                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="d-flex align-items-center gap-3">
                            <div>
                                <div class="ticket-label">出发站</div>
                                <div class="ticket-value">[[${ticket.train.startStation}]]</div>
                                <div class="text-muted">[[${ticket.train.departureTime}]]</div>
                            </div>
                            <div class="flex-grow-1">
                                <div class="progress" style="height: 3px;">
                                    <div class="progress-bar bg-primary" style="width: 100%"></div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <i class="bi bi-train"></i>
                                    <i class="bi bi-arrow-right"></i>
                                    <i class="bi bi-flag"></i>
                                </div>
                            </div>
                            <div>
                                <div class="ticket-label">到达站</div>
                                <div class="ticket-value">[[${ticket.train.endStation}]]</div>
                                <div class="text-muted">[[${ticket.train.arrivalTime}]]</div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="ticket-label">票价</div>
                        <div class="ticket-value">¥[[${ticket.train.price}]]</div>
                    </div>
                </div>

                <div class="ticket-divider"></div>

                <td>
                    <a th:if="${ticket.status == 'ACTIVE'}"
                       th:href="@{/tickets/refund/{id}(id=${ticket.id})}"
                       class="btn btn-danger btn-sm"
                       onclick="return confirm('确定要退票吗？退票后将原路返还车票金额');">
                        <i class="bi bi-ticket-slash me-1"></i>申请退票
                    </a>
                    <span th:unless="${ticket.status == 'ACTIVE'}" class="badge bg-secondary">已退票</span>
                </td>
            </div>
        </div>
    </div>

    <div th:if="${tickets == null or tickets.isEmpty()}" class="no-tickets">
        <div class="mb-3">
            <i class="bi bi-ticket-detailed fs-1"></i>
        </div>
        <h4>暂无车票</h4>
        <p class="text-muted mb-4">您还没有购买任何车票</p>
        <a href="/trains" class="btn btn-primary">
            <i class="bi bi-search me-2"></i>立即购票
        </a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>