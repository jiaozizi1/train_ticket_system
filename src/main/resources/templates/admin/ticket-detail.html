<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>车票详情 - 管理员后台</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
<!-- 导航栏 -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="/admin">管理员中心</a>
        <div class="collapse navbar-collapse">
            <div class="navbar-nav">
                <a class="nav-link" href="/admin/trains">车次管理</a>
                <a class="nav-link active" href="/admin/tickets">车票管理</a>
                <a class="nav-link" href="/admin/users">用户管理</a>
                <a class="nav-link" href="/logout">退出登录</a>
            </div>
        </div>
    </div>
</nav>

<div class="container py-4">
    <div class="row mb-4">
        <div class="col">
            <a href="/admin/tickets" class="btn btn-outline-secondary mb-2"><i class="bi bi-arrow-left"></i> 返回列表</a>
            <h2>车票详情</h2>
        </div>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="card-title"><i class="bi bi-ticket-detailed"></i> 基本信息</h5>
                    <table class="table table-borderless">
                        <tr>
                            <th width="30%">车票ID：</th>
                            <td th:text="${ticket.id}"></td>
                        </tr>
                        <tr>
                            <th>车票编号：</th>
                            <td th:text="${ticket.ticketNumber}"></td>
                        </tr>
                        <tr>
                            <th>状态：</th>
                            <td>
                                <span th:if="${ticket.status == 'ACTIVE'}" class="badge bg-success">有效车票</span>
                                <span th:if="${ticket.status == 'REFUNDED'}" class="badge bg-secondary">已退票</span>
                            </td>
                        </tr>
                        <tr>
                            <th>购票时间：</th>
                            <td th:text="${#temporals.format(ticket.purchaseTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        </tr>
                        <tr th:if="${ticket.refundTime != null}">
                            <th>退票时间：</th>
                            <td th:text="${#temporals.format(ticket.refundTime, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        </tr>
                    </table>
                </div>

                <div class="col-md-6">
                    <h5 class="card-title"><i class="bi bi-person"></i> 乘车人信息</h5>
                    <table class="table table-borderless">
                        <tr>
                            <th width="30%">姓名：</th>
                            <td th:text="${ticket.passengerName} ?: '未填写'"></td>
                        </tr>
                        <tr>
                            <th>身份证号：</th>
                            <td th:text="${ticket.passengerIdCard} ?: '未填写'"></td>
                        </tr>
                        <tr>
                            <th>手机号：</th>
                            <td th:text="${ticket.passengerPhone} ?: '未填写'"></td>
                        </tr>
                        <tr>
                            <th>座位号：</th>
                            <td th:text="${ticket.seatNumber} ?: '未分配'"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <hr>

            <div class="row">
                <div class="col-md-6">
                    <h5 class="card-title"><i class="bi bi-person-circle"></i> 用户信息</h5>
                    <table class="table table-borderless">
                        <tr>
                            <th width="30%">用户ID：</th>
                            <td th:text="${ticket.user != null ? ticket.user.id : '未知'}"></td>
                        </tr>
                        <tr>
                            <th>用户名：</th>
                            <td th:text="${ticket.user != null ? ticket.user.username : '未知用户'}"></td>
                        </tr>
                        <tr>
                            <th>用户角色：</th>
                            <td th:text="${ticket.user != null ? (ticket.user.roles != null ? ticket.user.roles : '普通用户') : '未知'}"></td>
                        </tr>
                    </table>
                </div>

                <div class="col-md-6">
                    <h5 class="card-title"><i class="bi bi-train"></i> 车次信息</h5>
                    <table class="table table-borderless">
                        <tr>
                            <th width="30%">车次ID：</th>
                            <td th:text="${ticket.train != null ? ticket.train.id : '未知'}"></td>
                        </tr>
                        <tr>
                            <th>车次编号：</th>
                            <td th:text="${ticket.train != null ? ticket.train.trainNumber : '未知车次'}"></td>
                        </tr>
                        <tr>
                            <th>行程：</th>
                            <td th:text="${ticket.train != null ? (ticket.train.startStation + ' → ' + ticket.train.endStation) : '未知'}"></td>
                        </tr>
                        <tr>
                            <th>出发时间：</th>
                            <td th:text="${ticket.train != null ? #temporals.format(ticket.train.departureTime, 'yyyy-MM-dd HH:mm') : '未知'}"></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="mt-4">
                <a href="/admin/tickets" class="btn btn-secondary"><i class="bi bi-arrow-left"></i> 返回列表</a>
                <button type="button" class="btn btn-primary" onclick="window.print()"><i class="bi bi-printer"></i> 打印详情</button>

                <div class="float-end">
                    <form th:action="@{/admin/tickets/{id}/delete(id=${ticket.id})}" method="get" class="d-inline">
                        <button type="submit" class="btn btn-danger" onclick="return confirm('确定要删除这条车票记录吗？')"><i class="bi bi-trash"></i> 删除记录</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>